(function(a){a.widget("db.jWizard",{_stepIndex:0,_stepCount:0,_actualCount:0,_create:function(){this._buildSteps();this._buildTitle();if(this.options.menuEnable){this._buildMenu()}this._buildButtons();if(this.options.counter.enable){this._buildCounter()}this.element.addClass("ui-widget jw-widget");this.element.find(".ui-state-default").live("mouseover mouseout",function(b){if(b.type==="mouseover"){a(this).addClass("ui-state-hover")}else{a(this).removeClass("ui-state-hover")}});this._changeStep(this._stepIndex,true)},destroy:function(){this._destroySteps();this._destroyTitle();if(this.options.menuEnable){this._destroyMenu()}this._destroyButtons();if(this.options.counter.enable){this._destroyCounter()}this.element.removeClass("ui-widget");this.element.find(".ui-state-default").unbind("mouseover").unbind("mouseout");a.Widget.prototype.destroy.call(this)},disable:function(){this.element.addClass("ui-state-disabled").find("button").attr("disabled","disabled")},enable:function(){this.element.removeClass("ui-state-disabled").find("button").removeAttr("disabled")},_setOption:function(b,d){var c=b.split(".");if(c.length>1){switch(c[0]){case"buttons":this.options[c[0]][c[1]]=d;switch(c[1]){case"jqueryui":this.options[c[0]][c[1]][c[2]]=d;if(c[2]==="enable"){if(d){this.find(".jw-buttons > button").button("destroy")}else{this._destroyButtons();this._buildButtons()}break}break;case"cancelHide":this.element.find(".jw-button-cancel")[d?"addClass":"removeClass"]("ui-helper-hidden");break;case"cancelType":this.element.find(".jw-button-cancel").attr("type",d);break;case"finishType":this.element.find(".jw-button-finish").attr("type",d);break;case"cancelText":this.element.find(".jw-button-cancel").text(d);break;case"previousText":this.element.find(".jw-button-previous").text(d);break;case"nextText":this.element.find(".jw-button-next").text(d);break;case"finishText":this.element.find(".jw-button-finish").text(d);break}break;case"counter":this.options[c[0]][c[1]]=d;switch(c[1]){case"enable":if(d){this._buildCounter();this._updateCounter()}else{this._destroyCounter()}break;case"type":case"progressbar":case"location":if(this.options.counter.enable){this._destroyCounter();this._buildCounter();this._updateCounter()}break;case"startCount":case"startHide":case"finishCount":case"finishHide":case"appendText":case"orientText":if(this.options.counter.enable){this._updateCounter()}break}break;case"effects":if(c.length===2){this.options[c[0]][c[1]]=d}else{this.options[c[0]][c[1]][c[2]]=d}break}}else{this.options[c[0]]=d;switch(c[0]){case"titleHide":this.element.find(".jw-header")[d?"addClass":"removeClass"]("ui-helper-hidden");break;case"menuEnable":if(d){this._buildMenu();this._updateMenu()}else{this._destroyMenu()}break;case"counter":this._destroyCounter();this._buildCounter();this._updateCounter();break}}},firstStep:function(){this.changeStep(0,"first")},lastStep:function(){this.changeStep(this._stepCount-1,"last")},nextStep:function(){var b={wizard:this.element,currentStepIndex:this._stepIndex,nextStepIndex:this._stepIndex+1,delta:1};if(this._trigger("next",null,b)!==false){this.changeStep(this._stepIndex+1,"next")}},previousStep:function(){var b={wizard:this.element,currentStepIndex:this._stepIndex,nextStepIndex:this._stepIndex-1,delta:-1};if(this._trigger("previous",null,b)!==false){this.changeStep(this._stepIndex-1,"previous")}},changeStep:function(b,d){d=d||"manual";b=typeof b==="number"?b:a(b).index();var c={wizard:this.element,currentStepIndex:this._stepIndex,nextStepIndex:b,delta:b-this._stepIndex,type:d};if(this._trigger("changestep",null,c)!==false){this._changeStep(b)}},_effect:function(b,f,g,d,h){var e=this,c=this.options.effects[f][g];d=d||"effect";if(!b.length||!b.hasClass("jw-animated")){b[d]();if(h){h.call(this)}return false}c.callback=h||a.noop;b[d](c.type,c.options,c.duration,c.callback)},_log:function(){if(this.options.debug&&window.console){console.log[console.firebug?"apply":"call"](console,Array.prototype.slice.call(arguments))}},_updateNavigation:function(b){this._updateButtons();if(this.options.menuEnable){this._updateMenu(b)}if(this.options.counter.enable){this._updateCounter(b)}},_buildTitle:function(){this.element.prepend(a("<div />",{"class":"jw-header ui-widget-header ui-corner-top"+(this.options.hideTitle?" ui-helper-hidden":""),html:'<h2 class="jw-title'+((this.options.effects.enable||this.options.effects.title.enable)?" jw-animated":"")+'" />'}))},_updateTitle:function(d){var c=this,b=this.element.find(".jw-title"),e=this.element.find(".jw-step:eq("+this._stepIndex+")");if(!d){this._effect(b,"title","hide","hide",function(){b.text(e.attr("title"));c._effect(b,"title","show","show")})}else{b.text(e.attr("title"))}},_destroyTitle:function(){a(".jw-header").remove()},_buildSteps:function(){var b=this.element.children("div, fieldset");this._stepCount=b.length;b.addClass("jw-step").each(function(c){var d=a(this);if(this.tagName.toLowerCase()==="fieldset"){d.attr("title",d.find("legend").text())}});if(this.options.effects.enable||this.options.effects.step.enable){b.addClass("jw-animated")}b.hide().wrapAll(a("<div />",{"class":"jw-content ui-widget-content ui-helper-clearfix",html:'<div class="jw-steps-wrap" />'})).eq(this._stepIndex).show()},_destroySteps:function(){a(".jw-step").show().unwrap().unwrap();a(".jw-step").unbind("show").unbind("hide").removeClass("jw-step")},_changeStep:function(b,d){var c=this,f=this.element.find(".jw-step"),e=f.eq(this._stepIndex);if(typeof b==="number"){if(b<0||b>(f.length-1)){alert("Index "+b+" Out of Range");return false}b=f.eq(b)}else{if(typeof b==="object"){if(!b.is(f.selector)){alert("Supplied Element is NOT one of the Wizard Steps");return false}}}if(!d){this._disableButtons();this._stepIndex=f.index(b);this._updateTitle(d);this._effect(e,"step","hide","hide",function(){c._effect(b,"step","show","show",function(){c._enableButtons();c._updateNavigation(d)})})}else{this._stepIndex=f.index(b);this._updateTitle(d);this._updateNavigation(d)}},_buildMenu:function(){var d=[],c,b;this.element.addClass("jw-hasmenu");this.element.find(".jw-step").each(function(e){d.push(a("<li />",{"class":"ui-corner-all "+(e===0?"jw-current ui-state-highlight":"jw-inactive ui-state-disabled"),html:a("<a />",{step:e,text:a(this).attr("title")})})[0])});c=a("<div />",{"class":"jw-menu-wrap",html:a("<div />",{"class":"jw-menu",html:a("<ol />",{html:a(d)})})});this.element.find(".jw-content").prepend(c);if(this.options.effects.enable||this.options.effects.menu.enable){c.find("li").addClass("jw-animated")}},_destroyMenu:function(){this.element.removeClass("jw-hasmenu").find(".jw-menu-wrap").remove()},_updateMenu:function(e){var d=this,b=this._stepIndex,c=this.element.find(".jw-menu");if(!e){this._effect(c.find("li:eq("+b+")"),"menu","change")}c.find("a").each(function(f){var h=a(this),j=h.parent(),g=parseInt(h.attr("step"),10),i="";if(g<b){i+="jw-active ui-state-default"}else{if(g===b){i+="jw-current ui-state-highlight"}else{if(g>b){i+="jw-inactive ui-state-disabled";h.removeAttr("href")}}}j.removeClass("jw-active jw-current jw-inactive ui-state-default ui-state-highlight ui-state-disabled").addClass(i)})},_buildCounter:function(){var b=a("<span />",{"class":"jw-counter ui-widget-content ui-corner-all jw-"+this.options.counter.orientText});if(this.options.counter.location==="header"){this.element.find(".jw-header").prepend(b)}else{if(this.options.counter.location==="footer"){this.element.find(".jw-footer").prepend(b)}}if(!this.options.counter.startCount){this._stepCount--}if(!this.options.counter.finishCount){this._stepCount--}if(this.options.effects.enable||this.options.effects.counter.enable){b.addClass("jw-animated")}if(this.options.counter.progressbar){b.html('<span class="jw-counter-text" /> <span class="jw-counter-progressbar" />').find(".jw-counter-progressbar").progressbar()}},_updateCounter:function(f){var h=this.element.find(".jw-counter"),c=this.options.counter,e="",d=this._stepIndex,g=this._stepCount,b=0;if(!c.startCount){d--;g--}if(!f){this._effect(h,"counter","change")}b=Math.round((d/g)*100);if(c.type==="percentage"){e=((b<=100)?b:100)+"%"}else{if(c.type==="count"){if(d<0){e=0}else{if(d>g){e=g}else{e=d}}e+=" of "+g}else{e="N/A"}}if(c.appendText){e+=" "+c.appendText}if(c.progressbar){this.element.find(".jw-counter-progressbar").progressbar("option","value",b);this.element.find(".jw-counter-text").text(e)}else{h.text(e)}if((c.startHide&&this._stepIndex===0)||(c.finishHide&&this._stepIndex===(this._actualCount-1))){h.hide()}else{h.show()}},_destroyCounter:function(){this.element.find(".jw-counter").remove()},_buildButtons:function(){var d=this,e=this.options.buttons,c=a("<div />",{"class":"jw-footer ui-widget-header ui-corner-bottom"}),h=a('<button type="'+e.cancelType+'" class="ui-state-default ui-corner-all jw-button-cancel jw-priority-secondary"'+(e.cancelHide?" ui-helper-hidden":"")+'">'+e.cancelText+"</button>"),f=a('<button type="button" class="ui-state-default ui-corner-all jw-button-previous">'+e.previousText+"</button>"),b=a('<button type="button" class="ui-state-default ui-corner-all jw-button-next">'+e.nextText+"</button>"),g=a('<button type="'+e.finishType+'" class="ui-state-default ui-corner-all jw-button-finish ui-state-highlight">'+e.finishText+"</button>");h.click(function(i){d._trigger("cancel",i)});f.click(function(i){d.previousStep()});b.click(function(i){d.nextStep()});g.click(function(i){d._trigger("finish",i)});if(e.jqueryui.enable){h.button({icons:{primary:e.jqueryui.cancelIcon}});f.button({icons:{primary:e.jqueryui.previousIcon}});b.button({icons:{secondary:e.jqueryui.nextIcon}});g.button({icons:{secondary:e.jqueryui.finishIcon}})}this.element.append(c.append(a('<div class="jw-buttons" />').append(h).append(f).append(b).append(g)))},_updateButtons:function(){var e=this.element.find(".jw-step"),c=this.element.find(".jw-button-previous"),b=this.element.find(".jw-button-next"),d=this.element.find(".jw-button-finish");switch(e.index(e.filter(":visible"))){case 0:c.hide();b.show();d.hide();break;case e.length-1:c.show();b.hide();d.show();break;default:c.show();b.show();d.hide();break}},_disableButtons:function(){this.element.find(".jw-buttons button").addClass("ui-state-disabled").attr("disabled",true)},_enableButtons:function(){this.element.find(".jw-buttons button").removeClass("ui-state-disabled").attr("disabled",false)},_destroyButtons:function(){this.element.find(".jw-footer").remove()},options:{debug:false,disabled:false,titleHide:false,menuEnable:false,buttons:{jqueryui:{enable:false,cancelIcon:"ui-icon-circle-close",previousIcon:"ui-icon-circle-triangle-w",nextIcon:"ui-icon-circle-triangle-e",finishIcon:"ui-icon-circle-check"},cancelHide:false,cancelType:"button",finishType:"button",cancelText:"Cancel",previousText:"Previous",nextText:"Next",finishText:"Finish"},counter:{enable:false,type:"count",progressbar:false,location:"footer",startCount:true,startHide:false,finishCount:true,finishHide:false,appendText:"Complete",orientText:"left"},effects:{enable:false,step:{enable:false,hide:{type:"slide",options:{direction:"left"},duration:"fast"},show:{type:"slide",options:{direction:"left"},duration:"fast"}},title:{enable:false,hide:{type:"slide",duration:"fast"},show:{type:"slide",duration:"fast"}},menu:{enable:false,change:{type:"highlight",duration:"fast"}},counter:{enable:false,change:{type:"highlight",duration:"fast"}}},cancel:a.noop,previous:a.noop,next:a.noop,finish:a.noop,changestep:function(b,c){if(b.isDefaultPrevented()){if(typeof b.nextStepIndex!=="undefined"){c.wizard.jWizard("changeStep",b.nextStepIndex);return false}}}}})}(jQuery));