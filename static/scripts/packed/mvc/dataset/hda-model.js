define(["mvc/dataset/states","mvc/history/history-content-base","utils/localization"],function(a,f,c){var d=f.HistoryContent;var b=d.extend({defaults:_.extend(_.clone(d.prototype.defaults),{model_class:"HistoryDatasetAssociation",history_content_type:"dataset",data_type:"",file_size:0,file_ext:"",meta_files:[],misc_blurb:"",misc_info:"",tags:[]}),initialize:function(g,h){this.log(this+".initialize",this.attributes);this.log("\tparent history_id: "+this.get("history_id"));if(!this.get("accessible")){this.set("state",a.NOT_VIEWABLE)}d.prototype.initialize.call(this,g,h)},_setUpListeners:function(){this.on("change:state",function(h,g){this.log(this+" has changed state:",h,g);if(this.inReadyState()){this.trigger("state:ready",h,g,this.previous("state"))}})},hasDetails:function(){return _.has(this.attributes,"genome_build")},hasData:function(){return(this.get("file_size")>0)},urls:function(){var g=d.prototype.urls.call(this);id=this.get("id");if(!id){return g}var h={purge:galaxy_config.root+"datasets/"+id+"/purge_async",display:galaxy_config.root+"datasets/"+id+"/display/?preview=True",edit:galaxy_config.root+"datasets/"+id+"/edit",download:galaxy_config.root+"datasets/"+id+"/display?to_ext="+this.get("file_ext"),report_error:galaxy_config.root+"dataset/errors?id="+id,rerun:galaxy_config.root+"tool_runner/rerun?id="+id,show_params:galaxy_config.root+"datasets/"+id+"/show_params",visualization:galaxy_config.root+"visualization",annotation:{get:galaxy_config.root+"dataset/get_annotation_async?id="+id,set:galaxy_config.root+"dataset/annotate_async?id="+id},meta_download:galaxy_config.root+"dataset/get_metadata_file?hda_id="+id+"&metadata_name="};return _.extend(g,h)},purge:function e(g){if(this.get("purged")){return jQuery.when()}g=g||{};g.url=galaxy_config.root+"datasets/"+this.get("id")+"/purge_async";var h=this,i=jQuery.ajax(g);i.done(function(l,j,k){h.set({deleted:true,purged:true})});i.fail(function(n,j,m){var k=c("Unable to purge dataset");var l=("Removal of datasets by users is not allowed in this Galaxy instance");if(n.responseJSON&&n.responseJSON.error){k=n.responseJSON.error}else{if(n.responseText.indexOf(l)!==-1){k=l}}n.responseText=k;h.trigger("error",h,n,g,c(k),{error:k})});return i},searchAttributes:d.prototype.searchAttributes.concat(["file_ext","genome_build","misc_blurb","misc_info","annotation","tags"]),searchAliases:_.extend(_.clone(d.prototype.searchAliases),{format:"file_ext",database:"genome_build",blurb:"misc_blurb",description:"misc_blurb",info:"misc_info",tag:"tags"}),toString:function(){var g=this.get("id")||"";if(this.get("name")){g=this.get("hid")+' :"'+this.get("name")+'",'+g}return"HDA("+g+")"}});return{HistoryDatasetAssociation:b}});